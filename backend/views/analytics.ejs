<%- include('partials/header') %>

<main class="container">
  <header class="page-header">
    <div class="header-content">
      <h1>Hospital Analytics & Insights</h1>
      <p style="color: var(--secondary)">
        Real-time performance monitoring and medical device status.
      </p>
    </div>
  </header>

  <div class="analytics-grid">
    <section class="card chart-container">
      <div class="card-header">
        <h2>Monthly Revenue Overview</h2>
      </div>
      <div style="position: relative; height: 350px">
        <canvas id="revenueChart"></canvas>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Medical Device Status</h2>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Device Name</th>
              <th>Status</th>
              <th>Last Maintenance</th>
              <th>Usage Level</th>
            </tr>
          </thead>
          <tbody>
            <% if (typeof devices !== 'undefined' && devices.length > 0) { %> <%
            devices.forEach(function(device) { %>
            <tr>
              <td><strong><%= device.device_name %></strong></td>
              <td>
                <span
                  class="status-pill <%= device.status === 'Active' ? 'bg-success' : (device.status === 'Maintenance' ? 'bg-warning' : 'bg-danger') %>"
                >
                  <%= device.status %>
                </span>
              </td>
              <td>
                <%= new Date(device.last_checked).toLocaleDateString('en-GB') %>
              </td>
              <td>
                <div style="display: flex; align-items: center; gap: 10px">
                  <progress
                    value="<%= device.usage_percent %>"
                    max="100"
                    style="flex: 1"
                  ></progress>
                  <span><%= device.usage_percent %>%</span>
                </div>
              </td>
            </tr>
            <% }); %> <% } else { %>
            <tr>
              <td
                colspan="4"
                style="
                  text-align: center;
                  padding: 2rem;
                  color: var(--secondary);
                "
              >
                No medical device data available.
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script src="/js/analytics.js"></script>

<%- include('partials/footer') %>
